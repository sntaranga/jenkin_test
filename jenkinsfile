pipeline {
    agent any

    options {
        skipDefaultCheckout()
    }

    stages {
        stage('Checkout and Maven Build') {
            stages {
                stage('Checkout') {
                    steps {
                        script {
                            mystep('checkout')
                        }
                    }
                }
                stage('Maven Build') {
                    steps {
                        script {
                            mystep('build')
                        }
                    }
                }
                stage('Thin Build') {
                    steps {
                        script {
                            mystep('thin build')
                        }
                    }
                }
            }
            post {
                always {
                    cleanWs()
                }
            }
        }
        
        stage('Docker Build and Publish') {
            steps {
                script {
                    mystep('B A P')
                }
            }
            post {
                always {
                    cleanWs()
                }
            }
        }
    }
}

def mystep(String name) {
    println "Hello $name"
    def random = new Random()
    def randomInt = (Math.random() * 60).toInteger() // Random integer between 0 and 99
    println "Random Integer using Math.random: $randomInt"

    sleep($randomInt)
}
